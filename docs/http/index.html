<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="../logo.svg">
<link rel="stylesheet" href="../tango.css" type="text/css">
<link rel="stylesheet" href="../mccole.css" type="text/css">
<title>The Sudonomicon &middot; HTTP</title>
<script>
  MathJax = {
    tex: {
      inlineMath: [['\\(', '\\)']]
    }
  };
</script>
<script
  type="text/javascript"
  id="MathJax-script"
  async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>

  <script defer data-domain="gvwilson.github.io/sys-tutorial" src="https://plausible.io/js/plausible.js"></script>


  </head>
  <body>
    <main>
      <div class="row notex">
  <div class="col-12 center">
    
      <h1>HTTP</h1>
    
  </div>
</div>

      
<nav class="row-always notex">
  <div class="col-1 left">
    <a href="../proc/" title="previous" class="undecorated">&#8678;</a>
  </div>
  <div class="col-10 center">
    <a href="../" title="home" class="undecorated">&#9737;</a>
  </div>
  <div class="col-1 right">
    <a href="../auth/" title="next" class="undecorated">&#8680;</a>
  </div>
</nav>


      
      <p class="terms">Terms defined: 
<a class="gl-ref" href="../glossary/#gl:character_encoding" markdown="1">character encoding</a>, <a class="gl-ref" href="../glossary/#gl:concurrency" markdown="1">concurrency</a>, <a class="gl-ref" href="../glossary/#gl:http" markdown="1">HTTP</a>, <a class="gl-ref" href="../glossary/#gl:http_header" markdown="1">header (of HTTP request or response)</a>, <a class="gl-ref" href="../glossary/#gl:http_method" markdown="1">HTTP method</a>, <a class="gl-ref" href="../glossary/#gl:http_request" markdown="1">HTTP request</a>, <a class="gl-ref" href="../glossary/#gl:http_response" markdown="1">HTTP response</a>, <a class="gl-ref" href="../glossary/#gl:http_status_code" markdown="1">HTTP status code</a>, <a class="gl-ref" href="../glossary/#gl:json" markdown="1">JavaScript Object Notation</a>, <a class="gl-ref" href="../glossary/#gl:local_server" markdown="1">local server</a>, <a class="gl-ref" href="../glossary/#gl:localhost" markdown="1">localhost</a>, <a class="gl-ref" href="../glossary/#gl:mime_type" markdown="1">MIME type</a>, <a class="gl-ref" href="../glossary/#gl:port" markdown="1">port</a>, <a class="gl-ref" href="../glossary/#gl:query_parameter" markdown="1">query parameter</a>, <a class="gl-ref" href="../glossary/#gl:refactor" markdown="1">refactor</a>, <a class="gl-ref" href="../glossary/#gl:resolve_path" markdown="1">resolve (a path)</a>, <a class="gl-ref" href="../glossary/#gl:sandbox" markdown="1">sandbox</a>, <a class="gl-ref" href="../glossary/#gl:static_file" markdown="1">static file</a>, <a class="gl-ref" href="../glossary/#gl:utf_8" markdown="1">UTF-8</a>, <a class="gl-ref" href="../glossary/#gl:web_scraping" markdown="1">web scraping</a>
</p>
      <h2>Start with Something Simple</h2>
<div class="language-py" title="get_remote.py">
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://gvwilson.github.io/safety-tutorial/site/motto.txt&quot;</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;status code: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;body:</span><span class="se">\n</span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</div>
<div class="language-out" title="get_remote.out">
<div class="highlight"><pre><span></span><code>status code: 200
body:
Start where you are, use what you have, help who you can.
</code></pre></div>
</div>
<ul>
<li>Use the <a href="https://requests.readthedocs.io/en/latest/"><code>requests</code></a> module to send an <a class="gl-ref" href="../glossary/#gl:http" markdown="1">HTTP</a> <a class="gl-ref" href="../glossary/#gl:http_request" markdown="1">request</a></li>
<li>The URL identifies the file we want<ul>
<li>Though as we&rsquo;ll see, the server can interpret it differently</li>
</ul>
</li>
<li>Response includes:<ul>
<li><a class="gl-ref" href="../glossary/#gl:http_status_code" markdown="1">HTTP status code</a> such as 200 (OK) or 404 (Not Found)</li>
<li>The text of the response</li>
</ul>
</li>
</ul>
<h2>What Just Happened</h2>
<ul>
<li><a class="fig-ref" href="../http/#http_lifecycle">Figure&nbsp;4.1</a> shows what happened</li>
</ul>
<figure id="http_lifecycle">
<img src="./http_lifecycle.svg" alt="HTTP request/response lifecycle"/>
<figcaption>Figure&nbsp;4.1: Lifecycle of an HTTP request and response</figcaption>
</figure>

<ul>
<li>Open a connection to the server</li>
<li>Send an <a class="gl-ref" href="../glossary/#gl:http_request" markdown="1">HTTP request</a> for the file we want</li>
<li>Server creates a <a class="gl-ref" href="../glossary/#gl:http_response" markdown="1">response</a> that includes the contents of the file</li>
<li>Sends it back</li>
<li><code>requests</code> parses the response and creates a Python object for us</li>
</ul>
<h2>Request Structure</h2>
<div class="language-py" title="dump_structure.py">
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">requests_toolbelt.utils</span> <span class="kn">import</span> <span class="n">dump</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://gvwilson.github.io/safety-tutorial/site/motto.txt&quot;</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">dump</span><span class="o">.</span><span class="n">dump_all</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>
</code></pre></div>
</div>
<div class="language-out" title="dump_structure.out">
<div class="highlight"><pre><span></span><code>GET /safety-tutorial/site/motto.txt HTTP/1.1
Host: gvwilson.github.io
User-Agent: python-requests/2.31.0
Accept-Encoding: gzip, deflate
Accept: */*
Connection: keep-alive
</code></pre></div>
</div>
<ul>
<li>First line is <a class="gl-ref" href="../glossary/#gl:http_method" markdown="1">method</a>, URL, and protocol version</li>
<li>Every HTTP request can have <a class="gl-ref" href="../glossary/#gl:http_header" markdown="1">headers</a> with extra information<ul>
<li>And optionally data being uploaded</li>
</ul>
</li>
<li>Yes, it&rsquo;s all just text<ul>
<li>Except for uploaded data, which is just bytes</li>
</ul>
</li>
</ul>
<h2>Response Structure</h2>
<div class="language-py" title="response_headers.py">
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://gvwilson.github.io/web-tutorial/site/motto.txt&quot;</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</div>
<div class="language-out" title="response_headers.out">
<div class="highlight"><pre><span></span><code>Connection: keep-alive
Content-Length: 5142
Server: GitHub.com
Content-Type: text/html; charset=utf-8
permissions-policy: interest-cohort=()
ETag: W/&quot;65c56fc7-239b&quot;
Content-Security-Policy: default-src &#39;none&#39;; style-src &#39;unsafe-inline&#39;; img-src data:; connect-src &#39;self&#39;
Content-Encoding: gzip
X-GitHub-Request-Id: A08C:5A357:7CF794:9CEA06:65D13923
Accept-Ranges: bytes
Date: Sat, 17 Feb 2024 22:54:27 GMT
Via: 1.1 varnish
Age: 0
X-Served-By: cache-yyz4563-YYZ
X-Cache: MISS
X-Cache-Hits: 0
X-Timer: S1708210467.301651,VS0,VE20
Vary: Accept-Encoding
X-Fastly-Request-ID: cb16df2dfa73aaf6de87924c743dd1e50a0ce570
</code></pre></div>
</div>
<ul>
<li>Every HTTP response also has with extra information<ul>
<li>Does <em>not</em> include status code: that appears in the first line</li>
</ul>
</li>
<li>Most important for now are:<ul>
<li><code>Content-Length</code>: number of bytes in response data (i.e., how much to read)</li>
<li><code>Content-Type</code>: <a class="gl-ref" href="../glossary/#gl:mime_type" markdown="1">MIME type</a> of data (e.g., <code>text/plain</code>)</li>
</ul>
</li>
<li>From now on we will only show interesting headers</li>
</ul>
<h2 class="exercise">Exercise</h2>
<ol>
<li>
<p>Add header called <code>Studying</code> with the value <code>safety</code>
    to the <code>requests</code> script shown above.
    Does it make a difference to the response?
    Should it?</p>
</li>
<li>
<p>What is the difference between the <code>Content-Type</code> and the <code>Content-Encoding</code> headers?</p>
</li>
</ol>
<h2>When Things Go Wrong</h2>
<div class="language-py" title="get_404.py">
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://gvwilson.github.io/web-tutorial/site/nonexistent.txt&quot;</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;status code: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;body length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</div>
<div class="language-out" title="get_404.out">
<div class="highlight"><pre><span></span><code>status code: 404
body length: 9115
</code></pre></div>
</div>
<ul>
<li>The 404 status code tells us something went wrong</li>
<li>The 9 kilobyte response is an HTML page with an embedded image (the GitHub logo)</li>
<li>The page contains human-readable error messages<ul>
<li>But we have to know page format to pull them out</li>
</ul>
</li>
</ul>
<h2 class="exercise">Exercise</h2>
<p>Look at <a href="https://en.wikipedia.org/wiki/List_of_HTTP_status_codes">this list of HTTP status codes</a>.</p>
<ol>
<li>
<p>What is the difference between status code 403 and status code 404?</p>
</li>
<li>
<p>What is status code 418 used for?</p>
</li>
<li>
<p>Under what circumstances would you expect to get a response whose status code is 505?</p>
</li>
</ol>
<h2>Getting JSON</h2>
<div class="language-py" title="get_json.py">
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://gvwilson.github.io/web-tutorial/site/motto.json&quot;</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;status code: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;body as text: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="si">}</span><span class="s2"> bytes&quot;</span><span class="p">)</span>
<span class="n">as_json</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;body as JSON:</span><span class="se">\n</span><span class="si">{</span><span class="n">as_json</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</div>
<div class="language-out" title="get_json.out">
<div class="highlight"><pre><span></span><code>status code: 200
body as text: 107 bytes
body as JSON:
{&#39;first&#39;: &#39;Start where you are&#39;, &#39;second&#39;: &#39;Use what you have&#39;, &#39;third&#39;: &#39;Help who you can&#39;}
</code></pre></div>
</div>
<ul>
<li>Parsing data out of HTML is called <a class="gl-ref" href="../glossary/#gl:web_scraping" markdown="1">web scraping</a><ul>
<li>Painful and error prone</li>
</ul>
</li>
<li>Better to have the server return data as data<ul>
<li>Preferred format these days is <a class="gl-ref" href="../glossary/#gl:json" markdown="1">JSON</a></li>
<li>So common that <code>requests</code> has built-in support</li>
</ul>
</li>
<li>Unfortunately, there is no standard for representing tabular data as JSON <a class="fig-ref" href="../http/#http_json_tables">Figure&nbsp;4.2</a><ul>
<li>A list with one list with N column names + N lists of values?</li>
<li>A list with N dictionaries, all with the same keys?</li>
<li>A dictionary with column names and lists of values, all the same length?</li>
</ul>
</li>
</ul>
<figure id="http_json_tables">
<img src="./http_json_tables.svg" alt="Three ways to represent tables as JSON"/>
<figcaption>Figure&nbsp;4.2: Representing tables as JSON</figcaption>
</figure>

<h2 class="exercise">Exercise</h2>
<p>Write a <code>requests</code> script that gets the current location and crew roster
of <a href="http://api.open-notify.org/">the International Space Station</a>.</p>
<h2>Local Web Server</h2>
<ul>
<li>Pushing files to GitHub so that we can use them is annoying</li>
<li>And we want to show how to make things <em>wrong</em> so that we can then make them <em>right</em></li>
<li>Use Python&rsquo;s <a href="https://docs.python.org/3/library/http.server.html"><code>http.server</code></a> module
    to run a <a class="gl-ref" href="../glossary/#gl:local_server" markdown="1">local server</a></li>
</ul>
<div class="language-sh" title="local_server.sh">
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>http.server<span class="w"> </span>-d<span class="w"> </span>site
</code></pre></div>
</div>
<ul>
<li>Host name is <a class="gl-ref" href="../glossary/#gl:localhost" markdown="1"><code>localhost</code></a></li>
<li>Uses <a class="gl-ref" href="../glossary/#gl:port" markdown="1">port</a> 8000 by default<ul>
<li>So URLs look like <code>http://localhost:8000/path/to/file</code></li>
</ul>
</li>
<li><code>-d site</code> tells the server to use <code>site</code> as its root directory</li>
<li>Use this local server for the next few examples<ul>
<li>Build our own server later on to show how it works</li>
</ul>
</li>
</ul>
<h2>Talk to Local Server</h2>
<div class="language-py" title="get_local.py">
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">URL</span> <span class="o">=</span> <span class="s2">&quot;http://localhost:8000/motto.txt&quot;</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">URL</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;status code: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;body:</span><span class="se">\n</span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</div>
<div class="language-out" title="get_local.out">
<div class="highlight"><pre><span></span><code>::ffff:127.0.0.1 - - [18/Feb/2024 09:12:24] &quot;GET /motto.txt HTTP/1.1&quot; 200 -
status code: 200
body:
Start where you are, use what you have, help who you can.
</code></pre></div>
</div>
<ul>
<li><a class="gl-ref" href="../glossary/#gl:concurrency" markdown="1">Concurrent</a> systems are hard to debug<ul>
<li>Multiple streams of activity</li>
<li>Order may change from run to run</li>
<li>Usually easiest to run each process in its own terminal window</li>
</ul>
</li>
</ul>
<h2>Our Own File Server</h2>
<div class="language-py" title="file_server_unsafe.py">
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">RequestHandler</span><span class="p">(</span><span class="n">BaseHTTPRequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">do_GET</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">url_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
            <span class="n">full_path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">url_path</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">&#39; =&gt; &#39;</span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">full_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="k">raise</span> <span class="n">ServerException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">full_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                <span class="k">raise</span> <span class="n">ServerException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2"> not file&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">handle_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">full_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">msg</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</code></pre></div>
</div>
<ul>
<li>Our <code>RequestHandler</code> handles a single <code>GET</code> request</li>
<li>Combine working directory with requested file path to get local path to file</li>
<li>Return that if it exists and is a file or raise an error</li>
</ul>
<h2>Support Code</h2>
<ul>
<li>Serve files</li>
</ul>
<div class="language-py" title="file_server_unsafe.py">
<div class="highlight"><pre><span></span><code>    <span class="k">def</span> <span class="nf">send_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">,</span> <span class="s2">&quot;text/html; charset=utf-8&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s2">&quot;Content-Length&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_headers</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</code></pre></div>
</div>
<ul>
<li>Handle errors</li>
</ul>
<div class="language-py" title="file_server_unsafe.py">
<div class="highlight"><pre><span></span><code><span class="n">ERROR_PAGE</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">&lt;html&gt;</span>
<span class="s2">  &lt;head&gt;&lt;title&gt;Error accessing </span><span class="si">{path}</span><span class="s2">&lt;/title&gt;&lt;/head&gt;</span>
<span class="s2">  &lt;body&gt;</span>
<span class="s2">    &lt;h1&gt;Error accessing </span><span class="si">{path}</span><span class="s2">: </span><span class="si">{msg}</span><span class="s2">&lt;/h1&gt;</span>
<span class="s2">  &lt;/body&gt;</span>
<span class="s2">&lt;/html&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>
</code></pre></div>
</div>
<div class="language-py" title="file_server_unsafe.py">
<div class="highlight"><pre><span></span><code>    <span class="k">def</span> <span class="nf">handle_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">ERROR_PAGE</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">content</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_content</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">HTTPStatus</span><span class="o">.</span><span class="n">NOT_FOUND</span><span class="p">)</span>
</code></pre></div>
</div>
<ul>
<li>Define our own exceptions so we&rsquo;re sure we&rsquo;re only catching what we expect</li>
</ul>
<div class="language-py" title="file_server_unsafe.py">
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ServerException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span>
</code></pre></div>
</div>
<h2>Running Our File Server</h2>
<div class="language-py" title="file_server_unsafe.py">
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">serverAddress</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">8000</span><span class="p">)</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">HTTPServer</span><span class="p">(</span><span class="n">serverAddress</span><span class="p">,</span> <span class="n">RequestHandler</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;serving in </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
    <span class="n">server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</code></pre></div>
</div>
<ul>
<li>And then get <code>motto.txt</code> as before</li>
</ul>
<h2>Built-in Safety</h2>
<ul>
<li>Modify <code>requests</code> script to take URL as command-line parameter</li>
</ul>
<div class="language-py" title="get_url.py">
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">URL</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">URL</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;status code: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;body:</span><span class="se">\n</span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</div>
<ul>
<li>Add a sub-directory to <code>site</code> called <code>sandbox</code> with a file <code>example.txt</code><ul>
<li>Called a <a class="gl-ref" href="../glossary/#gl:sandbox" markdown="1">sandbox</a> because it&rsquo;s a safe place to play</li>
</ul>
</li>
<li>Serve that sub-directory</li>
</ul>
<div class="language-sh" title="file_server_sandbox.sh">
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>src/file_server_unsafe.py<span class="w"> </span>site/sandbox
</code></pre></div>
</div>
<ul>
<li>Can get files from that directory</li>
</ul>
<div class="language-sh" title="get_url_allowed.sh">
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>src/get_url.py<span class="w"> </span>http://localhost:8000/example.txt
</code></pre></div>
</div>
<div class="language-out" title="get_url_allowed_server.out">
<div class="highlight"><pre><span></span><code>&#39;/example.txt&#39; =&gt; &#39;/tut/safety/site/sandbox/example.txt&#39;
127.0.0.1 - - [21/Feb/2024 06:04:32] &quot;GET /example.txt HTTP/1.1&quot; 200 -
</code></pre></div>
</div>
<div class="language-out" title="get_url_allowed_client.out">
<div class="highlight"><pre><span></span><code>status code: 200
body:
example file
</code></pre></div>
</div>
<ul>
<li>But not from parent directory (which isn&rsquo;t part of sandbox)</li>
</ul>
<div class="language-sh" title="get_url_disallowed.sh">
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>src/requests_local_url.py<span class="w"> </span>http://localhost:8000/motto.txt
</code></pre></div>
</div>
<div class="language-out" title="get_url_disallowed_server.out">
<div class="highlight"><pre><span></span><code>&#39;/motto.txt&#39; =&gt; &#39;/tut/safety/site/sandbox/motto.txt&#39;
127.0.0.1 - - [21/Feb/2024 06:04:38] &quot;GET /motto.txt HTTP/1.1&quot; 404 -
</code></pre></div>
</div>
<div class="language-out" title="get_url_disallowed_client.out">
<div class="highlight"><pre><span></span><code>status code: 404
body:
&lt;html&gt;
  &lt;head&gt;&lt;title&gt;Error accessing /motto.txt&lt;/title&gt;&lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Error accessing /motto.txt: /motto.txt not found&lt;/h1&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre></div>
</div>
<ul>
<li><code>requests</code> strips the leading <code>..</code> off the path before sending it</li>
<li>And if we try that URL in the browser, same thing happens</li>
<li>So we&rsquo;re safe, right?</li>
</ul>
<h2>Introducing netcat</h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Netcat"><code>netcat</code></a> (often just <code>nc</code>) is a computer networking tool</li>
<li>Open a connection, send exactly what the user types, and show exactly what is sent in response</li>
</ul>
<div class="language-sh" title="nc_localhost.sh">
<div class="highlight"><pre><span></span><code>nc<span class="w"> </span>localhost<span class="w"> </span><span class="m">8000</span>
</code></pre></div>
</div>
<div class="language-text" title="nc_allowed.text">
<div class="highlight"><pre><span></span><code>GET /example.txt HTTP/1.1
</code></pre></div>
</div>
<div class="language-out" title="nc_allowed.out">
<div class="highlight"><pre><span></span><code>HTTP/1.0 200 OK
Server: BaseHTTP/0.6 Python/3.12.1
Date: Thu, 22 Feb 2024 18:37:37 GMT
Content-Type: text/html; charset=utf-8
Content-Length: 13

example file
</code></pre></div>
</div>
<ul>
<li>Let&rsquo;s see what happens if we <em>do</em> send a URL with <code>..</code> in it</li>
</ul>
<div class="language-text" title="nc_disallowed.text">
<div class="highlight"><pre><span></span><code>GET ../motto.txt HTTP/1.1
</code></pre></div>
</div>
<div class="language-out" title="nc_disallowed.out">
<div class="highlight"><pre><span></span><code>HTTP/1.0 200 OK
Server: BaseHTTP/0.6 Python/3.12.1
Date: Thu, 22 Feb 2024 18:38:50 GMT
Content-Type: text/html; charset=utf-8
Content-Length: 58

Start where you are, use what you have, help who you can.
</code></pre></div>
</div>
<ul>
<li>We shouldn&rsquo;t be able to see files outside the sandbox</li>
<li>But if someone doesn&rsquo;t strip out the <code>..</code> characters, users can escape</li>
</ul>
<h2 class="exercise">Exercise</h2>
<p>The shortcut <code>~<em>username</em></code> means
&ldquo;the specified user&rsquo;s home directory&rdquo; in the shell,
while <code>~</code> on its own means &ldquo;the current user&rsquo;s home directory&rdquo;.
Create a file called <code>test.txt</code> in your home directory
and then try to get <code>~/test.txt</code> using your browser,
<code>requests</code>,
and <code>netcat</code>.
What happens with each and why?</p>
<h2>A Safer File Server</h2>
<div class="language-py" title="file_server_safe.py">
<div class="highlight"><pre><span></span><code>    <span class="k">def</span> <span class="nf">handle_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">given_path</span><span class="p">,</span> <span class="n">full_path</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">resolved_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">full_path</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>
            <span class="n">sandbox</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">resolved_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">sandbox</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ServerException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot access </span><span class="si">{</span><span class="n">given_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_content</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">HTTPStatus</span><span class="o">.</span><span class="n">OK</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ServerException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot find </span><span class="si">{</span><span class="n">given_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ServerException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot read </span><span class="si">{</span><span class="n">given_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</div>
<ul>
<li><a class="gl-ref" href="../glossary/#gl:resolve_path" markdown="1">Resolve</a> the constructed path</li>
<li>Then check that it&rsquo;s below the current working directory (i.e., the sandbox)</li>
<li>And fail if it isn&rsquo;t<ul>
<li>Using our own <code>ServerException</code> guarantees that all errors are handled the same way</li>
</ul>
</li>
</ul>
<h2 class="exercise">Exercise</h2>
<p><a class="gl-ref" href="../glossary/#gl:refactor" markdown="1">Refactor</a> the <code>do_GET</code> and <code>handle_file</code> methods in <code>RequestHandler</code>
so that all checks are in one place.
Does this make the code easier to understand overall?
Do you think making code easier to understand also makes it safer?</p>
<h2>Serving Data</h2>
<ul>
<li>Rarely have JSON lying around as <a class="gl-ref" href="../glossary/#gl:static_file" markdown="1">static files</a></li>
<li>More common to have either CSV or a database</li>
</ul>
<div class="language-sh" title="birds_head.sh">
<div class="highlight"><pre><span></span><code>head<span class="w"> </span>-n<span class="w"> </span><span class="m">10</span><span class="w"> </span>site/birds.csv
</code></pre></div>
</div>
<div class="language-out" title="birds_head.out">
<div class="highlight"><pre><span></span><code>loc_id,latitude,longitude,region,year,month,day,species_id,num
L13476859,60.8606726,-135.2015181,CA-YT,2021,2,1,redcro,3.0
L13476859,60.8606726,-135.2015181,CA-YT,2021,2,1,rebnut,1.0
L13476859,60.8606726,-135.2015181,CA-YT,2021,2,1,comred,13.0
L13476859,60.8606726,-135.2015181,CA-YT,2021,2,1,dowwoo,1.0
L13476859,60.8606726,-135.2015181,CA-YT,2021,2,1,bkcchi,3.0
L13476859,60.8606726,-135.2015181,CA-YT,2021,2,1,haiwoo,1.0
L13476859,60.8606726,-135.2015181,CA-YT,2021,2,8,nobird,
L13476859,60.8606726,-135.2015181,CA-YT,2021,2,15,rebnut,2.0
L13476859,60.8606726,-135.2015181,CA-YT,2021,2,15,bkcchi,3.0
</code></pre></div>
</div>
<ul>
<li>Modify server to generate it dynamically</li>
<li>Main program</li>
</ul>
<div class="language-py" title="bird_server_whole.py">
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">sandbox</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">sandbox</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">serverAddress</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">8000</span><span class="p">)</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">BirdServer</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">serverAddress</span><span class="p">,</span> <span class="n">RequestHandler</span><span class="p">)</span>
    <span class="n">server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</code></pre></div>
</div>
<ul>
<li>Create our own server class because we want to pass the dataframe in the constructor</li>
</ul>
<div class="language-py" title="bird_server_whole.py">
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">BirdServer</span><span class="p">(</span><span class="n">HTTPServer</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">server_address</span><span class="p">,</span> <span class="n">request_handler</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">server_address</span><span class="p">,</span> <span class="n">request_handler</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
</code></pre></div>
</div>
<ul>
<li><code>do_GET</code> converts the dataframe to JSON (will modify later to do more than this)</li>
</ul>
<div class="language-py" title="bird_server_whole.py">
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">RequestHandler</span><span class="p">(</span><span class="n">BaseHTTPRequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">do_GET</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">write_json</span><span class="p">(</span><span class="n">row_oriented</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_content</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">HTTPStatus</span><span class="o">.</span><span class="n">OK</span><span class="p">)</span>
</code></pre></div>
</div>
<ul>
<li><code>send_content</code> <a class="gl-ref" href="../glossary/#gl:character_encoding" markdown="1">encodes</a> the JSON string as <a class="gl-ref" href="../glossary/#gl:utf_8" markdown="1">UTF-8</a>
    and sets the MIME type to <code>application/json</code></li>
</ul>
<div class="language-py" title="bird_server_whole.py">
<div class="highlight"><pre><span></span><code>    <span class="k">def</span> <span class="nf">send_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
        <span class="n">content</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">,</span> <span class="s2">&quot;application/json; charset=utf-8&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s2">&quot;Content-Length&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_headers</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</code></pre></div>
</div>
<ul>
<li>Can view in browser at <code>http://localhost:8000</code> or use <code>requests</code> to fetch as before</li>
</ul>
<h2>Slicing Data</h2>
<ul>
<li>URL can contain <a class="gl-ref" href="../glossary/#gl:query_parameter" markdown="1">query parameters</a></li>
<li>Want <code>http://localhost:8000/?year=2021&amp;species=rebnut</code> to select red-breasted nuthatches in 2021</li>
<li>Put slicing in a method of its own</li>
</ul>
<div class="language-py" title="bird_server_slice.py">
<div class="highlight"><pre><span></span><code>    <span class="k">def</span> <span class="nf">do_GET</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_data</span><span class="p">()</span>
        <span class="n">as_json</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;records&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_content</span><span class="p">(</span><span class="n">as_json</span><span class="p">,</span> <span class="n">HTTPStatus</span><span class="o">.</span><span class="n">OK</span><span class="p">)</span>
</code></pre></div>
</div>
<ul>
<li>Use <code>urlparse</code> and <code>parse_qs</code> from <a href="https://docs.python.org/3/library/urllib.parse.html"><code>urllib.parse</code></a> to get query parameters<ul>
<li>(Key, list) dictionary</li>
</ul>
</li>
<li>Then filter data as requested</li>
</ul>
<div class="language-py" title="bird_server_slice.py">
<div class="highlight"><pre><span></span><code>    <span class="k">def</span> <span class="nf">filter_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">parse_qs</span><span class="p">(</span><span class="n">urlparse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">query</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">_data</span>
        <span class="k">if</span> <span class="s2">&quot;species&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">species</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;species&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;species_id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">species</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;year&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">year</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">result</span>
</code></pre></div>
</div>
<h2 class="exercise">Exercise</h2>
<ol>
<li>
<p>Write a function that takes a URL as input
    and returns a dictionary whose keys are the query parameters&rsquo; names
    and whose values are lists of their values.
    Do you now see why you should use the library function to do this?</p>
</li>
<li>
<p>Modify the server so that clients can specify which columns they want returned
    as a comma-separated list of names.
    If the client asks for a column that doesn&rsquo;t exist, ignore it.</p>
</li>
<li>
<p>Modify your solution to the previous exercise so that
    if the client asks for a column that doesn&rsquo;t exist
    the server returns a status code 400 (Bad Request)
    and a JSON blog with two keys:
    <code>status_code</code> (set to 400)
    and <code>error_message</code> (set to something informative).
    Explain why the server should return JSON rather than HTML in the case of an error.</p>
</li>
</ol>
    </main>
    <footer>
   2024 <a href="https://third-bit.com/">Greg Wilson</a>
  &middot;
  <a href="../">home</a>
  &middot;
  <a href="https://github.com/gvwilson/sys-tutorial">repository</a>
  &middot;
  <a href="../license/">license</a>
</footer>

  </body>
</html>
